parameters:
- name: stages
  type: stageList
  default: []

- name: pool
  type: object
  default: {}

- name: containers
  type: object
  default: {}

# Sdl rules with the highest priority
- name: enforcedSdl
  type: object
  default: {}

# User specified / applied across the pipeline, can be overridden by job specific sdl setting
- name: sdl
  type: object
  default: {}

- name: settings
  type: object
  default: {}

- name: authenticatedContainerRegistries
  type: object
  default: null

- name: customBuildTags
  type: object
  default: null

- name: customLogIssues
  type: object
  default: null

- name: featureFlags
  type: object
  default: {}

- name: serviceTreeId
  type: string
  default: ''

- name: sdp
  type: object
  default: {}

extends:
  template: ./1ES.Pipeline.yml
  parameters:
    isOfficial: false
    stages: ${{ parameters.stages }}
    pool: ${{ parameters.pool }}
    containers: ${{ parameters.containers }}
    settings: ${{ parameters.settings }}
    sdl: ${{ parameters.sdl }}
    enforcedSdl: ${{ parameters.enforcedSdl }}
    authenticatedContainerRegistries: ${{ parameters.authenticatedContainerRegistries }}
    featureFlags: ${{ parameters.featureFlags }}
    serviceTreeId: ${{ parameters.serviceTreeId }}
    sdp: ${{ parameters.sdp }}
    customBuildTags:
    - ${{ each tag in parameters.customBuildTags }}:
      - ${{ tag }}
    - 1ES.PT.Unofficial
    customLogIssues:
    - ${{ each issue in parameters.customLogIssues }}:
      - ${{ issue }}
    - ${{ if or(ne('', parameters.sdl.codeSignValidation.useTestSign), ne(convertToJson(parameters.stages.*.jobs.*.templateContext.sdl.codeSignValidation.useTestSign), '[]')) }}:
      - type: warning
        message: "1ES PT Warning: sdl.codeSignValidation.useTestSign parameter will soon be deprecated. Note that test sign will always be allowed in unofficial template. Hence you can simply remove the parameter to avoid this warning."
    - ${{ if ne('', parameters.enforcedSdl.codeSignValidation.useTestSign) }}:
      - type: warning
        message: "1ES PT Warning: enforcedSdl.codeSignValidation.useTestSign parameter will soon be deprecated. Note that test sign will always be allowed in unofficial template. Hence you can simply remove the parameter to avoid this warning."
